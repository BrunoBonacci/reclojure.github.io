{"version":3,"sources":["portal/runtime/web/client.cljs"],"mappings":";AAGA,GAAA,QAAAA,mCAAAC,2CAAAC,+CAAAC,sDAAAC;AAAA;AAAA,AAAA,oCAAA,2CAAA,/EAASC,kJAAsB,6CAAA,7CAACC;;AAEhC,oCAAA,pCAAMC,gFAASC,QAAQC;AAAvB,AACE,IAAAC,qBAAA,AAAAC,gBAAuBH;AAAvB,AAAA,oBAAAE;AAAA,mBAAAA,fAASE;AAAT,AACE,OAACC,oBACA,AAA4BD,mCAAa,AAACE,qBAASL,QAAQJ,oCAC3DA;;AACD,MAAO,gDAAA,hDAACU,kEAA0BN;;;AAEtC,uCAAA,vCAAOO,sFAAYR,QAAQS;AAA3B,AACE,0CAAA,2CAAA,kDAAA,qFAAA,5NAACV,kCAAQC,kPAA2CS;;AACpD,AAACC,sBAAOC,wBAAYF;;AACpBA;;AAEF,mCAAA,nCAAOG,8EAAQZ;AAAf,AACE,OAAA,gGAAe,0CAAA,2CAAA,kDAAA,vIAACD,kCAAQC;;AAE1B,AAAA;;;;;;;;;;;;AAAA,AAAA,CAAA,AAAA,6EAAA,7EAASiB,wFAEEE;;AAFX,AAAA,gBAAA,ZAEWA;AAFX,AAEkB,OAACP,iCAAOZ;;;AAF1B,CAAA,AAAA,mFAAA,nFAASiB,8FAIGE,MAAMV;;AAJlB,AAAA,gBAAA,ZAIYU;AAJZ,AAI6B,OAACX,qCAAWR,eAAQS;;;AAJjD,CAAA,AAAA,iFAAA,jFAASQ,4FAMEG,MAAKC;;AANhB,AAAA,gBAAA,ZAMWD;AANX,AAOI,OAACV,sBAAOU,UAAK,iBAAAE,WAAA,AAAAnB,gBAAIiB;AAAJ,AAAA,0EAAAE,wBAAAA,1FAACD,kCAAAA,4CAAAA;;;;AAPlB,CAAA,AAAA,iFAAA,jFAASJ,4FAQEG,MAAKC,EAAEE;;AARlB,AAAA,gBAAA,ZAQWH;AARX,AASI,OAACV,sBAAOU,UAAK,iBAAAI,WAAA,AAAArB,gBAAIiB;IAAJK,WAASF;AAAT,AAAA,0EAAAC,SAAAC,wBAAAD,SAAAC,5GAACJ,kCAAAA,qDAAAA;;;;AATlB,CAAA,AAAA,iFAAA,jFAASJ,4FAUEG,MAAKC,EAAEE,EAAEG;;AAVpB,AAAA,gBAAA,ZAUWN;AAVX,AAWI,OAACV,sBAAOU,UAAK,iBAAAO,WAAA,AAAAxB,gBAAIiB;IAAJQ,WAASL;IAATM,WAAWH;AAAX,AAAA,0EAAAC,SAAAC,SAAAC,wBAAAF,SAAAC,SAAAC,9HAACR,kCAAAA,8DAAAA;;;;AAXlB,CAAA,AAAA,iFAAA,jFAASJ,4FAYEG,MAAKC,EAAEE,EAAEG,EAAEI;;AAZtB,AAAA,gBAAA,ZAYWV;AAZX,AAaI,OAACV,sBAAOU,UAAK,gDAAA,AAAAjB,hDAAC4B,8CAAMV,kBAAGD,WAAKG,EAAEG,EAAEI;;;AAbpC,CAAA,4CAAA,5CAASb;AAAT,AAAA,AAAA;;;AAAA,CAAA,kDAAA,lDAASA;;AAAT,CAAA,qDAAA,rDAASA;;AAAT,CAAA,0DAAA,WAAAJ,mBAAAC,qBAAAC,7GAASE;AAAT,AAAA,OAAAD,iBAAAF,qBAAA;;;AAAA;;;wCAAA,xCAASI,wFAAQlB;AAAjB,AAAA,YAAAiB,iCAAiBjB;;;AAARiB,AAeT,sCAAA,tCAAMe,oFAAWhC;AAAjB,AAA0B,YAAAiB,iCAASjB","names":["js/portal","js/portal.runtime","js/portal.runtime.web","js/portal.runtime.web.client","js/portal.runtime.web.client.options","portal.runtime.web.client/options","cljs.core.atom","portal.runtime.web.client/request","session","message","temp__5751__auto__","cljs.core/deref","child-window","portal.runtime/read","portal.runtime/write","cljs.core.ex_info","portal.runtime.web.client/push-state","new-value","cljs.core/reset!","portal.runtime/selected","portal.runtime.web.client/datafy","this__4461__auto__","writer__4462__auto__","opt__4463__auto__","cljs.core/-write","portal.runtime.web.client/Portal","portal.runtime.web.client/->Portal","_this","this","f","G__70172","a","G__70182","G__70183","b","G__70194","G__70195","G__70196","xs","cljs.core.apply","portal.runtime.web.client/make-atom"],"sourcesContent":["(ns portal.runtime.web.client\n  (:require [portal.runtime :as rt]))\n\n(defonce options {:value-cache (atom {})})\n\n(defn request [session message]\n  (if-let [child-window @session]\n    (rt/read\n     (.portal.ui.rpc.handler ^js child-window (rt/write message options))\n     options)\n    (throw (ex-info \"Portal not open\" message))))\n\n(defn- push-state [session new-value]\n  (request session {:op :portal.rpc/push-state :state new-value})\n  (reset! rt/selected new-value)\n  new-value)\n\n(defn- datafy [session]\n  (:portal/value (request session {:op :portal.rpc/datafy})))\n\n(deftype Portal [session]\n  IDeref\n  (-deref [_this] (datafy session))\n  IReset\n  (-reset! [_this new-value] (push-state session new-value))\n  ISwap\n  (-swap! [this f]\n    (reset! this (f @this)))\n  (-swap! [this f a]\n    (reset! this (f @this a)))\n  (-swap! [this f a b]\n    (reset! this (f @this a b)))\n  (-swap! [this f a b xs]\n    (reset! this (apply f @this a b xs))))\n\n(defn make-atom [session] (Portal. session))\n\n"]}